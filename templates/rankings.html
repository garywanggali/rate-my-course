{% extends "base.html" %}

{% block title %}排行榜 - 课程评价平台{% endblock %}

{% block content %}
<div class="container">
    <h1><i class="fas fa-trophy"></i> 课程排行榜</h1>
    
    <div class="filters">
        <form method="GET" action="{% url 'rankings' %}" class="filter-form">
            <div class="filter-group">
                <select name="school_id" class="filter-select">
                    <option value="">所有学校</option>
                    {% for school in schools %}
                        <option value="{{ school.school_id }}" {% if school_id == school.school_id %}selected{% endif %}>
                            {{ school.name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="filter-group">
                <select name="category_id" class="filter-select">
                    <option value="">所有类别</option>
                    {% for cat in categories %}
                        <option value="{{ cat.category_id }}" {% if category_id == cat.category_id %}selected{% endif %}>{{ cat.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" class="btn btn-primary">筛选</button>
            <a href="{% url 'rankings' %}" class="btn btn-secondary">清除</a>
        </form>
    </div>

    <div class="rankings-list">
        {% for course, avg_score, rating_count in top_courses %}
        <div class="ranking-item">
            <div class="ranking-number">{{ loop.index }}</div>
            <div class="ranking-content">
                <h3><a href="{% url 'course_detail' course_id=course.course_id %}">{{ course.title }}</a></h3>
                <div class="ranking-meta">
                    <span class="course-code">{{ course.code }}</span>
                    <span>
                        <i class="fas fa-university"></i> {{ course.school.name }}
                        {% if course.school.school_type == 'highschool' %}
                            <span class="school-type-badge school-type-high-school">高中</span>
                        {% else %}
                            <span class="school-type-badge school-type-university">大学</span>
                        {% endif %}
                    </span>
                    <span><i class="fas fa-layer-group"></i> {{ course.category.name }}</span>
                </div>
                <div class="ranking-rating">
                    <div class="star-rating" style="--rating: {{ avg_score|floatformat:1 }};" aria-label="评分 {{ avg_score|floatformat:1 }} / 5"></div>
                    <span class="rating-text">{{ avg_score|floatformat:1 }}/5.0</span>
                    <span class="rating-count">({{ rating_count }} 评价)</span>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
