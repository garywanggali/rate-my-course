<div class="comment-item">
    <div class="comment-header">
        <span class="comment-user">
            <i class="fas fa-user"></i>
            <span>{{ comment.user.username }}</span>
        </span>
        <span class="comment-date">{{ comment.created_at|date:"Y-m-d H:i" }}</span>
    </div>
    <div class="comment-text">{{ comment.text }}</div>
    {% if user.is_authenticated %}
    <div class="comment-actions">
        <button class="btn-link toggle-reply-form" data-comment-id="{{ comment.comment_id }}" data-rating-id="{{ comment.rating_id }}">
            <i class="fas fa-reply"></i> 回复
        </button>
        <button class="btn-link toggle-report-form" data-entity-type="comment" data-entity-id="{{ comment.comment_id }}">
            <i class="fas fa-flag"></i> 举报
        </button>
    </div>
    {% endif %}

    <div class="replies">
        {% for reply in comment.children %}
            {% with comment=reply %}
                {% include 'comment_item.html' %}
            {% endwith %}
        {% endfor %}
    </div>

    <div class="reply-form" id="reply-form-{{ comment.comment_id }}" style="display: none;">
        <form method="POST" action="{% url 'add_comment' rating_id=comment.rating_id %}">
            {% csrf_token %}
            <input type="hidden" name="parent_comment_id" value="{{ comment.comment_id }}">
            <textarea name="text" rows="2" placeholder="写下你的回复..." required></textarea>
            <button type="submit" class="btn btn-sm">提交</button>
        </form>
    </div>
</div>
